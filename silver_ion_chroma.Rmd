---
title: "Silver Ion Chroma"
author: "Tristan Caro"
date: "12/10/2020"
output: html_document
---

A BAMES standard was run through two silver ion (Ag) columns to test the efficacy/cleanliness of the columns. A **Supelco Ag-Ion Discovery** column "Disc" and a homemade **Silver Nitrate** "Nitr" column were both tested (protocol courtesy of Nicolo Ardenghi).

- Instrument method: `OG_DB-1_F9_longMethod_fullscan_300Csource_cyclohexane_FAMES`
- Processing Method: `BAMES STANDARD`

# Protocol
TC-BAME2 was taken from OGL Center Mini -20˚C. 245µg of total lipid BAME was suspended in 245µL of hex.
10µL (10µg) was removed and combined with 250µL hexane. The entirey of this stock (10µg) was applied to the Ag column.

0. Set up Ag-Ion columns over waste colleciton vials.
1. Condition SPE with 4mL acetone
2. Equilibrate cartridge with 4mL hexane. 
3. Load FAMEs in hexane derived from sample extraction at a flow rate of 2-3 drops/second. Remove waste collection vials and replace with fraction 1 (F1) collection vials (40mL glass vials).
4. Elute F1 with 6mL hexane:acetone 96:4
*Fraction 1 targets saturated FAs, trans monoenes, cis/cis and trans/trans conjugated linoleic acids*
5. Elute F2 with 4mL hexane:acetone 90:10
*Fraction 2 will target: cis monoenes, trans/trans dienes, CLAs*
6. Elute F3 with 4mL acetone
*Fraction 3 targets cis/cis dienes, other dienes, trienes.*
7. Evaporate all fractions at 40˚C under N2, sparge.
8. Reconstituted in three 100µL hexane washes, added to a GC vial with insert.
8. Evaporated at 40˚C under N2, reconstituted in 50µL cyclohexane for GC analysis.

# Data

```{r, include = FALSE}
# Libraries
library(tidyverse)
library(plotly)

# Source
source(file.path("libs", "visualization.R"))
source(file.path("libs", "chromleon.R"))
```

## Data Import
```{r}
# Define the root directory and the path names for each file
root <- "data"
path_names = c("2020.12.09_TC_BAMES_Agion/2020.12.09_TC_BAMES_Agion_DB1/TSQ7517_TCBAMES_2_5ug_ul.xls",
          "2020.12.09_TC_BAMES_Agion/2020.12.09_TC_BAMES_Agion_DB1/TSQ7518_BAMES_F1_Disc.xls",
          "2020.12.09_TC_BAMES_Agion/2020.12.09_TC_BAMES_Agion_DB1/TSQ7519_BAMES_F2_Disc.xls",
          "2020.12.09_TC_BAMES_Agion/2020.12.09_TC_BAMES_Agion_DB1/TSQ7520_BAMES_F3_Disc.xls",
          "2020.12.09_TC_BAMES_Agion/2020.12.09_TC_BAMES_Agion_DB1/TSQ7521_BAMES_F1_Nitr.xls",
          "2020.12.09_TC_BAMES_Agion/2020.12.09_TC_BAMES_Agion_DB1/TSQ7522_BAMES_F2_Nitr.xls")
# Define the sample names
sample_names = c("tc_bames2", "bames_disc_f1", "bames_disc_f2", "bames_disc_f3", "bames_nitr_f1", "bames_nitr_f2")

# read_chromeleon_export is a sourced R function. See above.
all_data <-
  tibble(
    sample = sample_names,
    file = path_names,
    data = map(file.path(root, file), read_chromeleon_export),
    injection_details = map(data, "injection_details"),
    integration_results = map(data, "integration_results")
  ) %>% select(-data)

```

## Data Cleanup
``` {r}
results <- all_data %>% 
  select(-injection_details) %>% 
  unnest(integration_results) %>% 
  filter(nchar(`Peak Name`) > 0) %>% 
  # major compound groups
  mutate(
    group = `Peak Name` %>% str_remove("\\d+-OH") %>% parse_number() %>% abs() %>% {paste0("C", .)} %>% factor()
  ) 
```

## Plot
```{r}
p_tc_bames2 <- results %>%
  filter(sample == c("tc_bames2")) %>% 
  ggplot() +
  aes(`Retention Time`, `Relative Height`, fill = `Peak Name`) +
  geom_bar(stat = 'identity', width = 0.1)+
  scale_fill_viridis_d() +
  ggtitle("BAMES Standard 10µg/µL") +
  theme_bw()

p_tc_bames2 %>% ggplotly(dynamicTicks = TRUE)
```
```{r}
p_bames_disc_f1 <- results %>%
  filter(sample == c("bames_disc_f1")) %>% 
  ggplot() +
  aes(`Retention Time`, `Relative Height`, fill = `Peak Name`) +
  geom_bar(stat = 'identity', width = 0.1)+
  scale_fill_viridis_d() +
  labs(title = "BAMES Discovery Ag-Ion F1", subtitle = "saturated FAs, trans monoenes, cis/cis and trans/trans conjugated linoleic acids") +
  theme_bw()

p_bames_disc_f1 %>% ggplotly(dynamicTicks = TRUE)
```
```{r}
p_bames_disc_f2 <- results %>%
  filter(sample == c("bames_disc_f2")) %>% 
  ggplot() +
  aes(`Retention Time`, `Relative Height`, fill = `Peak Name`) +
  geom_bar(stat = 'identity', width = 0.1)+
  scale_fill_viridis_d() +
  labs(title = "BAMES Discovery Ag-Ion F2", subtitle = "cis monoenes, trans/trans dienes, CLAs") +
  theme_bw()

p_bames_disc_f2 %>% ggplotly(dynamicTicks = TRUE)
```

```{r}
p_bames_disc_f3 <- results %>%
  filter(sample == c("bames_disc_f3")) %>% 
  ggplot() +
  aes(`Retention Time`, `Relative Height`, fill = `Peak Name`) +
  geom_bar(stat = 'identity', width = 0.1)+
  scale_fill_viridis_d() +
  labs(title = "BAMES Discovery Ag-Ion F3", subtitle = "cis/cis dienes, other dienes, trienes.") +
  theme_bw()

p_bames_disc_f3 %>% ggplotly(dynamicTicks = TRUE)
```
```{r}
p_bames_nitr_f1 <- results %>%
  filter(sample == c("bames_nitr_f1")) %>% 
  ggplot() +
  aes(`Retention Time`, `Relative Height`, fill = `Peak Name`) +
  geom_bar(stat = 'identity', width = 0.1)+
  scale_fill_viridis_d() +
  labs(title = "BAMES Ag - Nitrate F1") +
  theme_bw()

p_bames_nitr_f1 %>% ggplotly(dynamicTicks = TRUE)
```

```{r}
p_bames_nitr_f2 <- results %>%
  filter(sample == c("bames_nitr_f2")) %>% 
  ggplot() +
  aes(`Retention Time`, `Relative Height`, fill = `Peak Name`) +
  geom_bar(stat = 'identity', width = 0.1)+
  scale_fill_viridis_d() +
  labs(title = "BAMES Ag - Nitrate F2") +
  theme_bw()

p_bames_nitr_f2 %>% ggplotly(dynamicTicks = TRUE)
```
#### Issue with R plotting
Facet wrapping results in incomplete plotting - data points in tc_bames2 are not plotted.
```{r}
p_tc_bames2 <- results %>%
  filter(sample == c("tc_bames2", "bames_disc_f1", "bames_nitr_f1")) %>% 
  ggplot() +
  aes(`Retention Time`, `Relative Height`, fill = `Peak Name`) +
  geom_bar(stat = 'identity', width = 0.1)+
  facet_wrap(~sample, nrow = 1, scales = "free_y") +
  scale_fill_viridis_d() +
  ggtitle("BAMES Standard 10µg/µL") +
  theme_bw()

p_tc_bames2 %>% ggplotly(dynamicTicks = TRUE)

```